<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="Description">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css">
</head>
<body>
  <div id="app"></div>
  <script>
    window.$docsify = {
      name: 'Miramar Songs',
      repo: '',

      loadSidebar: true,
      maxLevel: 3,
      subMaxLevel: 3,

      markdown: {
        gfm: true,
        breaks: true
      },

      // markdown (marked, renderer) {
      //   // NOTE read these docs, docsify uses an "old" marked
      //   // https://github.com/markedjs/marked/blob/v4.2.12/docs/USING_ADVANCED.md
      //   marked.setOptions({
      //     gfm: true,
      //     breaks: true,
      //     // walkTokens (token) {
      //     //   console.log(JSON.stringify(token, null, 2))
      //     // }
      //   })

      //   return marked
      // },

      themeColor: '#468cb2',

      plugins: [
        function embedYoutube (hook, vm) {
          const regexp = /((https:\/\/)?www\.)?youtube\.com\/watch\?v=([a-zA-Z0-9]+)/g

          hook.beforeEach(markdown => {
            return markdown.replaceAll(regexp, ((...match) => {
              const id = match[3]
              return `<iframe
                 width="560"
                 height="400"
                 src="https://www.youtube.com/embed/${id}"
                 title="YouTube video player"
                 frameborder="0"
                 allow="accelerometer;
                 autoplay; clipboard-write;
                 encrypted-media; gyroscope;
                 picture-in-picture; 
                 web-share" allowfullscreen>
              </iframe>`
            }))
          })

          hook.doneEach(() => {
            const linkEls = document.querySelectorAll('a[href*="youtube.com/watch"]') 
            ;[...linkEls].forEach(linkEl => {
              const match = regexp.exec(linkEl.href)
              const id = match[3]

              const iframe = document.createElement('iframe')
              iframe.setAttribute('src', `https://www.youtube.com/embed/${id}`)
              iframe.setAttribute('width', 560)
              iframe.setAttribute('height', 400)
              // iframe.setAttribute('title', 'YouTube video player')
              iframe.setAttribute('frameborder', 0)
              iframe.setAttribute('allowfullscreen', true)
              iframe.setAttribute('picture-in-picture', true)

              linkEl.prepend(iframe)
            })
          })
        }
      ]
    }
  </script>

  <!-- Docsify v4 -->
  <script src="//cdn.jsdelivr.net/npm/docsify/lib/docsify.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>
</body>
</html>
